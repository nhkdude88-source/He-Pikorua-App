<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta name="apple-mobile-web-app-capable" content="yes">

    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <title>He Pikorua Tracker</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }

        .slide-in { animation: slideIn 0.3s ease-out forwards; }

        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        .fade-in { animation: fadeIn 0.3s ease-out forwards; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .bg-pattern {

            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);

            background-size: 20px 20px;

        }

        /* Custom scrollbar hiding */

        ::-webkit-scrollbar { width: 0px; background: transparent; }

    </style>

</head>

<body class="bg-gray-50 text-gray-800 h-screen flex flex-col overflow-hidden">



    <!-- HEADER -->

    <header class="bg-slate-900 text-white p-4 shadow-lg flex justify-between items-center z-10 shrink-0 pt-safe-top">

        <div>

            <h1 class="text-lg font-bold tracking-tight">He Pikorua <span class="text-emerald-400">Action</span></h1>

        </div>

        <button onclick="showHome()" class="text-slate-300 hover:text-white p-2"><i class="fa-solid fa-house fa-lg"></i></button>

    </header>



    <!-- MAIN CONTENT AREA -->

    <main id="app-content" class="flex-1 overflow-y-auto bg-pattern relative pb-20">

        <!-- Views injected here -->

    </main>



    <!-- FOOTER NAVIGATION -->

    <footer id="footer-nav" class="bg-white border-t border-gray-200 p-2 hidden shrink-0 grid grid-cols-4 gap-1 text-xs text-center pb-safe-bottom z-20">

        <!-- Injected via JS -->

    </footer>



    <!-- ADD CASE MODAL -->

    <div id="add-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 fade-in">

        <div class="bg-white rounded-xl p-6 w-full max-w-sm shadow-2xl">

            <h3 class="text-lg font-bold mb-4">Add New Case</h3>

            

            <label class="text-xs font-bold text-gray-500 uppercase">Mokopuna Name</label>

            <input type="text" id="new-name" placeholder="e.g. Hemi T." class="w-full mb-3 p-3 border rounded-lg bg-gray-50">

            

            <label class="text-xs font-bold text-gray-500 uppercase">Kura / School</label>

            <input type="text" id="new-kura" placeholder="e.g. Nuhaka School" class="w-full mb-3 p-3 border rounded-lg bg-gray-50">

            

            <label class="text-xs font-bold text-blue-600 uppercase"><i class="fa-brands fa-google-drive mr-1"></i> Google Doc Link</label>

            <input type="text" id="new-doc-link" placeholder="Paste Doc URL here..." class="w-full mb-4 p-3 border border-blue-200 rounded-lg bg-blue-50 text-sm">

            

            <div class="flex gap-2">

                <button onclick="closeModal()" class="flex-1 py-3 rounded-lg bg-gray-200 font-bold text-gray-600">Cancel</button>

                <button onclick="saveNewCase()" class="flex-1 py-3 rounded-lg bg-emerald-600 text-white font-bold">Save</button>

            </div>

        </div>

    </div>



    <!-- JAVASCRIPT LOGIC -->

    <script>

        // --- DATA STORE ---

        let cases = JSON.parse(localStorage.getItem('rtlb_cases_v2')) || [];

        let currentCaseId = null;



        function saveData() {

            localStorage.setItem('rtlb_cases_v2', JSON.stringify(cases));

        }



        // --- VIEWS ---



        // 1. HOME DASHBOARD

        function showHome() {

            currentCaseId = null;

            const content = document.getElementById('app-content');

            document.getElementById('footer-nav').classList.add('hidden');

            

            let caseListHtml = cases.length > 0 ? cases.map(c => `

                <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-emerald-500 mb-3 active:scale-95 transition-transform flex justify-between items-center group relative">

                    <div onclick="openCase(${c.id})" class="flex-1 cursor-pointer">

                        <h3 class="font-bold text-lg text-slate-800 truncate pr-2">${c.name}</h3>

                        <p class="text-sm text-slate-500 truncate"><i class="fa-solid fa-school mr-1"></i> ${c.kura}</p>

                        ${c.docUrl ? `<p class="text-xs text-blue-600 mt-1"><i class="fa-solid fa-link mr-1"></i> Linked to Doc</p>` : ''}

                    </div>

                    <button onclick="deleteCase(${c.id})" class="text-gray-300 hover:text-red-500 p-3"><i class="fa-solid fa-trash"></i></button>

                </div>

            `).join('') : `<div class="text-center py-10 text-gray-400">No active cases.<br>Tap '+' to add a Mokopuna.</div>`;



            content.innerHTML = `

                <div class="p-4 fade-in max-w-md mx-auto">

                    <div class="flex justify-between items-center mb-4">

                        <h2 class="text-xl font-bold text-slate-800">My Caseload</h2>

                        <button onclick="openModal()" class="bg-slate-900 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg active:scale-90 transition-transform"><i class="fa-solid fa-plus"></i></button>

                    </div>

                    ${caseListHtml}

                </div>

            `;

        }



        // 2. CASE VIEW

        function openCase(id) {

            currentCaseId = id;

            const c = cases.find(x => x.id === id);

            if(!c) return showHome();

            

            const content = document.getElementById('app-content');

            document.getElementById('footer-nav').classList.remove('hidden');

            renderFooter(id);



            const docButton = c.docUrl 

                ? `<a href="${c.docUrl}" target="_blank" class="block w-full text-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-lg text-sm mb-4"><i class="fa-solid fa-arrow-up-right-from-square mr-2"></i> Open Google Doc</a>`

                : `<button onclick="alert('No link saved! Delete and re-add this case to add a link.')" class="block w-full text-center bg-gray-200 text-gray-500 font-bold py-2 rounded-lg text-sm mb-4">No Doc Linked</button>`;



            content.innerHTML = `

                <div class="p-4 slide-in max-w-md mx-auto">

                    <div class="bg-slate-800 text-white p-4 rounded-xl mb-6 shadow-lg">

                        <h2 class="text-2xl font-bold">${c.name}</h2>

                        <p class="opacity-80 mb-2">${c.kura}</p>

                        ${docButton}

                    </div>

                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Workflow Phases</h3>

                    <div class="grid grid-cols-1 gap-3">

                        ${renderPhaseButton(id, '1. Te Waharoa', 'Admin & Consent', 'fa-door-open', 'bg-blue-50 text-blue-700')}

                        ${renderPhaseButton(id, '3. Kohikohi', 'Te Whare o Oro Scan', 'fa-ear-listen', 'bg-purple-50 text-purple-700')}

                        ${renderPhaseButton(id, '5. Tātai', 'ReGrOWTH Plan', 'fa-compass-drafting', 'bg-orange-50 text-orange-700')}

                        ${renderPhaseButton(id, '6. Whakamahi', 'Log Contact/Mahi', 'fa-person-walking', 'bg-emerald-50 text-emerald-700')}

                        ${renderPhaseButton(id, '7. Whai Whakaaro', 'Outcome Scales', 'fa-scale-balanced', 'bg-cyan-50 text-cyan-700')}

                    </div>

                </div>

            `;

        }



        function renderPhaseButton(id, title, sub, icon, colorClass) {

            return `

            <button onclick="openForm(${id}, '${title}')" class="${colorClass} p-4 rounded-xl flex items-center shadow-sm text-left active:scale-95 transition-transform">

                <div class="w-10 h-10 rounded-full bg-white/50 flex items-center justify-center mr-4 shrink-0">

                    <i class="fa-solid ${icon} text-lg"></i>

                </div>

                <div>

                    <div class="font-bold">${title}</div>

                    <div class="text-xs opacity-80">${sub}</div>

                </div>

            </button>`;

        }



        // 3. FORM VIEWS

        function openForm(id, phase) {

            currentCaseId = id;

            const content = document.getElementById('app-content');

            let formHtml = '';



            // --- PHASE 3: KOHIKOHI ---

            if (phase.includes('Kohikohi')) {

                formHtml = `

                    <div class="space-y-6">

                        <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100">

                            <h4 class="font-bold text-slate-700 mb-2 border-b pb-1">1. Te Tūāpapa (Environment)</h4>

                            <input type="text" id="p3_universal" class="w-full p-3 bg-gray-50 rounded mb-2 border-gray-200" placeholder="Te Matua (Universal)...">

                            <input type="text" id="p3_targeted" class="w-full p-3 bg-gray-50 rounded border-gray-200" placeholder="Te Kāhui (Targeted)...">

                        </div>

                        <div class="bg-white p-4 rounded-lg shadow-sm border border-purple-100">

                            <h4 class="font-bold text-purple-800 mb-2 border-b pb-1">2. Te Whare o Oro Scan</h4>

                            <div class="space-y-3">

                                ${renderCheckbox('p3_tuarongo', 'Pou Tuarongo (Safety)', 'red')}

                                ${renderCheckbox('p3_tahu', 'Pou Tāhū (Rhythm)', 'yellow')}

                                ${renderCheckbox('p3_tokomanawa', 'Pou Tokomanawa (Connect)', 'blue')}

                                ${renderCheckbox('p3_kaiawha', 'Pou Kaiāwhā (Learning)', 'green')}

                            </div>

                        </div>

                    </div>

                `;

            } 

            // --- PHASE 5: TĀTAI ---

            else if (phase.includes('Tātai')) {

                formHtml = `

                    <div class="bg-white p-4 rounded-lg shadow-sm space-y-4">

                        <h4 class="font-bold text-orange-700 mb-2 border-b pb-1">ReGrOWTH Planner</h4>

                        <textarea id="p5_reality" class="w-full p-3 bg-gray-50 rounded border h-20" placeholder="Reality (Current State)..."></textarea>

                        <input type="text" id="p5_goal" class="w-full p-3 bg-gray-50 rounded border" placeholder="Growing Goal...">

                        <input type="text" id="p5_will" class="w-full p-3 bg-gray-50 rounded border" placeholder="Will (Who does what?)...">

                        <textarea id="p5_tactics" class="w-full p-3 bg-gray-50 rounded border h-20" placeholder="Tactics (Strategies)..."></textarea>

                    </div>

                `;

            }

            // --- PHASE 6: WHAKAMAHI (Log) ---

            else if (phase.includes('Whakamahi')) {

                const today = new Date().toISOString().split('T')[0];

                formHtml = `

                    <div class="bg-white p-4 rounded-lg shadow-sm space-y-4">

                        <h4 class="font-bold text-emerald-700 mb-2 border-b pb-1">Real-Time Contact Log</h4>

                        <input type="date" id="p6_date" class="w-full p-3 bg-gray-50 rounded border" value="${today}">

                        <select id="p6_type" class="w-full p-3 bg-gray-50 rounded border">

                            <option>Kanohi ki te kanohi (Visit)</option>

                            <option>Email / Phone</option>

                            <option>Observation</option>

                            <option>Coaching Session</option>

                        </select>

                        <textarea id="p6_notes" class="w-full p-3 bg-gray-50 rounded border h-24" placeholder="Mahi / Notes..."></textarea>

                    </div>

                `;

            }

            else {

                formHtml = `<div class="p-8 text-center text-gray-400">Section available in full doc.</div>`;

            }



            content.innerHTML = `

                <div class="p-4 slide-in max-w-md mx-auto">

                    <div class="flex items-center mb-4">

                        <button onclick="openCase(${id})" class="mr-3 text-slate-500 p-2"><i class="fa-solid fa-arrow-left"></i></button>

                        <h2 class="font-bold text-lg text-slate-800 truncate">${phase}</h2>

                    </div>

                    ${formHtml}

                    <button onclick="generateAndOpen('${phase}')" class="mt-6 w-full bg-slate-900 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition-transform flex justify-center items-center">

                        <i class="fa-solid fa-file-pen mr-2 text-emerald-400"></i> Update Doc

                    </button>

                    <p class="text-center text-xs text-gray-400 mt-2">Copies text & opens Google Docs</p>

                </div>

            `;

        }



        function renderCheckbox(id, label, color) {

            return `

            <div class="p-2 bg-${color}-50 rounded border border-${color}-100">

                <label class="flex items-center cursor-pointer mb-2">

                    <input type="checkbox" id="${id}" class="w-5 h-5 accent-${color}-600 mr-2">

                    <span class="font-bold text-${color}-800 text-sm">${label}</span>

                </label>

                <input type="text" id="${id}_note" class="w-full p-2 text-sm bg-white border border-${color}-200 rounded" placeholder="Observed behaviour...">

            </div>`;

        }



        // 4. GENERATE & OPEN DOC

        function generateAndOpen(phase) {

            let text = "";

            const currentCase = cases.find(c => c.id === currentCaseId);



            // Generate Text

            if (phase.includes('Kohikohi')) {

                text = `**PHASE 3: KOHIKOHI (Data Scan)**\n> **Universal:** ${getValue('p3_universal')}\n> **Targeted:** ${getValue('p3_targeted')}\n`;

                if(getChecked('p3_tuarongo')) text += `> [x] Pou Tuarongo: ${getValue('p3_tuarongo_note')}\n`;

                if(getChecked('p3_tahu')) text += `> [x] Pou Tāhū: ${getValue('p3_tahu_note')}\n`;

                if(getChecked('p3_tokomanawa')) text += `> [x] Pou Tokomanawa: ${getValue('p3_tokomanawa_note')}\n`;

                if(getChecked('p3_kaiawha')) text += `> [x] Pou Kaiāwhā: ${getValue('p3_kaiawha_note')}\n`;

            } 

            else if (phase.includes('Tātai')) {

                text = `**PHASE 5: TĀTAI (ReGrOWTH)**\n> **Reality:** ${getValue('p5_reality')}\n> **Goal:** ${getValue('p5_goal')}\n> **Will:** ${getValue('p5_will')}\n> **Tactics:** ${getValue('p5_tactics')}`;

            }

            else if (phase.includes('Whakamahi')) {

                text = `**LOG: ${getValue('p6_date')}**\n> **Type:** ${getValue('p6_type')}\n> **Notes:** ${getValue('p6_notes')}`;

            }



            // The Workflow: Copy -> Wait -> Open Doc

            navigator.clipboard.writeText(text).then(() => {

                if(currentCase && currentCase.docUrl) {

                    // Try to open the doc

                    window.location.href = currentCase.docUrl; 

                } else {

                    alert("Text copied! (No Doc Link saved to open)");

                }

            }).catch(() => {

                alert("Error copying. Please manually select text.");

            });

        }



        // HELPERS

        function getValue(id) { return document.getElementById(id) ? document.getElementById(id).value : ''; }

        function getChecked(id) { return document.getElementById(id) ? document.getElementById(id).checked : false; }

        

        // MODAL FUNCTIONS

        function openModal() { document.getElementById('add-modal').classList.remove('hidden'); }

        function closeModal() { document.getElementById('add-modal').classList.add('hidden'); }

        

        function saveNewCase() {

            const name = document.getElementById('new-name').value;

            const kura = document.getElementById('new-kura').value;

            const docUrl = document.getElementById('new-doc-link').value;

            

            if(name && kura) {

                cases.push({ id: Date.now(), name, kura, docUrl, phase: 'Te Waharoa' });

                saveData();

                closeModal();

                showHome();

                document.getElementById('new-name').value = '';

                document.getElementById('new-kura').value = '';

                document.getElementById('new-doc-link').value = '';

            }

        }



        function deleteCase(id) {

            if(confirm("Delete this case?")) {

                cases = cases.filter(c => c.id !== id);

                saveData();

                showHome();

            }

        }



        function renderFooter(id) {

            const footer = document.getElementById('footer-nav');

            footer.innerHTML = `

                <button onclick="openForm(${id}, '3. Kohikohi')" class="p-2 text-purple-700 hover:bg-purple-50 rounded flex flex-col items-center"><i class="fa-solid fa-ear-listen mb-1"></i> <span class="text-[10px]">Kohikohi</span></button>

                <button onclick="openForm(${id}, '5. Tātai')" class="p-2 text-orange-700 hover:bg-orange-50 rounded flex flex-col items-center"><i class="fa-solid fa-compass-drafting mb-1"></i> <span class="text-[10px]">Tātai</span></button>

                <button onclick="openForm(${id}, '6. Whakamahi')" class="p-2 text-emerald-700 hover:bg-emerald-50 rounded flex flex-col items-center"><i class="fa-solid fa-person-walking mb-1"></i> <span class="text-[10px]">Log</span></button>

                <button onclick="openForm(${id}, '7. Whai Whakaaro')" class="p-2 text-cyan-700 hover:bg-cyan-50 rounded flex flex-col items-center"><i class="fa-solid fa-scale-balanced mb-1"></i> <span class="text-[10px]">Review</span></button>

            `;

        }



        // Init

        showHome();

    </script>

</body>

</html>
